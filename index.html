<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Bar Graph Creator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 20px auto;
        background: #f4f4f4;
        padding: 20px;
    }
    h2 { text-align: center; margin-top: 0; }

    #controls {
        text-align: center;
        margin-bottom: 20px;
    }
    input { padding: 6px; margin-right: 10px; }
    button { padding: 6px 15px; margin: 5px; cursor: pointer; }

    #graph-wrapper {
        display: flex;
        align-items: flex-end;
    }

    /* Y-axis */
    #y-axis {
        width: 40px;
        position: relative;
        height: 350px;
        border-right: 2px solid black;
    }
    .y-number {
        position: absolute;
        left: 0;
        transform: translateY(50%);
        font-size: 12px;
    }

    #graph-area {
        position: relative;
        width: 100%;
        height: 350px;
        border-bottom: 2px solid black;
        padding-left: 10px;
        background: white;
        display: flex;
        align-items: flex-end;
        gap: 20px;
    }

    /* Horizontal grid lines */
    .grid-line {
        position: absolute;
        left: 0;
        width: 100%;
        height: 1px;
        background: #e2e2e2;
    }

    /* Bars + labels */
    .bar-box {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .bar {
        width: 50px;
        background: steelblue;
        border-radius: 5px 5px 0 0;
        text-align: center;
        color: white;
        font-weight: bold;
        padding-top: 5px;
        user-select: none;
    }

    .label {
        margin-top: 8px;
        font-size: 14px;
        width: 80px;
        text-align: center;
    }

    footer {
        text-align: center;
        margin-top: 25px;
        font-size: 16px;
    }

</style>
</head>
<body>

<h2>Student Bar Graph Creator</h2>

<div id="controls">
    <input type="text" id="category" placeholder="Category">
    <input type="number" id="value" placeholder="Value" min="0">
    <button onclick="addBar()">Add Bar</button>
    <button onclick="clearGraph()">Clear Graph</button>
    <button onclick="exportGraph()">Export as PNG</button>
</div>

<div id="graph-wrapper">
    <div id="y-axis"></div>

    <div id="graph-area"></div>
</div>

<script>
const GRAPH_HEIGHT = 350;
const SCALE = 5; // 1 data unit = 5px

function updateYAxis(maxValue) {
    const yAxis = document.getElementById("y-axis");
    yAxis.innerHTML = "";

    // Draw numbers + horizontal grid lines
    const graphArea = document.getElementById("graph-area");
    [...graphArea.querySelectorAll(".grid-line")].forEach(e => e.remove());

    for (let i = 0; i <= maxValue; i++) {
        const yPos = GRAPH_HEIGHT - i * SCALE;

        // number
        const num = document.createElement("div");
        num.className = "y-number";
        num.style.bottom = (i * SCALE) + "px";
        num.textContent = i;
        yAxis.appendChild(num);

        // grid line
        const gl = document.createElement("div");
        gl.className = "grid-line";
        gl.style.bottom = (i * SCALE) + "px";
        graphArea.appendChild(gl);
    }
}

function addBar() {
    const label = document.getElementById("category").value.trim();
    const value = parseInt(document.getElementById("value").value);

    if (!label || isNaN(value)) {
        alert("Enter both a label and a value.");
        return;
    }

    const graph = document.getElementById("graph-area");

    const box = document.createElement("div");
    box.className = "bar-box";

    const bar = document.createElement("div");
    bar.className = "bar";
    bar.style.height = (value * SCALE) + "px";
    bar.style.backgroundColor = randomColor();
    bar.textContent = value;

    // Drag to change height
    bar.onmousedown = startDrag;

    const lbl = document.createElement("div");
    lbl.className = "label";
    lbl.textContent = label;

    box.appendChild(bar);
    box.appendChild(lbl);
    graph.appendChild(box);

    updateYAxis(calculateMaxValue());

    document.getElementById("category").value = "";
    document.getElementById("value").value = "";
}

function calculateMaxValue() {
    const bars = [...document.querySelectorAll(".bar")];
    if (bars.length === 0) return 10;
    return Math.max(...bars.map(b => parseInt(b.textContent)));
}

function clearGraph() {
    document.getElementById("graph-area").innerHTML = "";
    document.getElementById("y-axis").innerHTML = "";
}

function randomColor() {
    return "hsl(" + Math.random()*360 + ",70%,50%)";
}

/******** Drag-to-resize ********/
let activeBar = null;
let startY = 0;
let startHeight = 0;

function startDrag(e) {
    activeBar = e.target;
    startY = e.clientY;
    startHeight = parseInt(activeBar.style.height);
    document.onmousemove = drag;
    document.onmouseup = stopDrag;
}

function drag(e) {
    if (!activeBar) return;
    let newHeight = startHeight + (startY - e.clientY);
    if (newHeight < 0) newHeight = 0;
    activeBar.style.height = newHeight + "px";
    activeBar.textContent = Math.round(newHeight / SCALE);
    updateYAxis(calculateMaxValue());
}

function stopDrag() {
    activeBar = null;
    document.onmousemove = null;
    document.onmouseup = null;
}

/******** Export ********/
function exportGraph() {
    const area = document.getElementById("graph-area");
    const canvas = document.createElement("canvas");
    canvas.width = area.offsetWidth;
    canvas.height = area.offsetHeight;
    const ctx = canvas.getContext("2d");

    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const boxes = [...area.children];

    boxes.forEach((box, i) => {
        const bar = box.querySelector(".bar");
        const label = box.querySelector(".label");
        const barHeight = parseInt(bar.style.height);
        const x = i * 70 + 20;
        const y = canvas.height - barHeight;

        ctx.fillStyle = bar.style.backgroundColor;
        ctx.fillRect(x, y, 50, barHeight);

        ctx.fillStyle = "#000";
        ctx.fillText(bar.textContent, x + 15, y - 5);
        ctx.fillText(label.textContent, x + 15, canvas.height - 5);
    });

    const link = document.createElement("a");
    link.download = "bar_graph.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
}
</script>

<footer>Created by Mr. Cucco 2025</footer>

</body>
</html>
